<ng-template #MainToolBar>
  <nav class="page-breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item fw-bold">
        <a routerLink=".">
          سندات القيد
        </a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        {{route.snapshot.params['id']>0?'تعديل':'إدخال'}} سند قيد
      </li>
    </ol>

    <div class="d-flex justify-content-end ms-auto">

      <app-sanad-kid-search-bar [Title]="'لائحة سندات القيد'" (OnSelectItem)="OnSelectItem($event)">
      </app-sanad-kid-search-bar>

      <button type="button" class="btn btn-info btn-sm" (click)="save()">
        <mat-icon>save</mat-icon>
        حفظ
      </button>


      <button type="button" class="btn btn-info btn-sm" (click)="save_as_draft()">
        <mat-icon>save</mat-icon>
        حفظ كمسودة
      </button>

    </div>

  </nav>


</ng-template>




<c-container fluid>

  <app-tool-bar [ngTemplateOutlet]="MainToolBar">
  </app-tool-bar>





  <c-row>
    <c-card class="mb-4 card " style="margin-top: 40px;">
      <c-card-header class="card-header">معلومات السند</c-card-header>
      <c-card-body class="card-body">

        <form [formGroup]="Form">

          <div class="row">


            <div class="col-3 mb-3">

              <div class="justify-content-center">
                <span class="white" style="display: block;">تاريخ السند</span>
                <div class="input-group inline input-group-lg">


                  <input class="form-control" placeholder="اليوم" (change)="sanadDateChange('day')"
                    [(ngModel)]='sanadDateDay' [ngModelOptions]="{standalone: true}" id="sanadDateDay"
                    (keyup.enter)="focusNext('sanadDateMonth')" [OnlyNumber]="true">




                  <input class="form-control" placeholder="الشهر" (change)="sanadDateChange('month')"
                    [(ngModel)]='sanadDateMonth' [ngModelOptions]="{standalone: true}" id="sanadDateMonth"
                    (keyup.enter)="focusNext('sanadDateYear')" [OnlyNumber]="true">


                  <input class="form-control" placeholder="السنة" (change)="sanadDateChange('year')"
                    [(ngModel)]='sanadDateYear' [ngModelOptions]="{standalone: true}" id="sanadDateYear"
                    (keyup.enter)="focusNext('document_id')" [OnlyNumber]="true">

                </div>

              </div>


            </div>

            <div class="col-3 mb-3">

              <mat-form-field appearance="outline">
                <mat-label>رقم السند</mat-label>
                <input matInput [formControl]="document_id" id="document_id"
                  (keyup.enter)="focusNext('incumbentDateDay')" [OnlyNumber]="true">
              </mat-form-field>



            </div>


            <div class="col-3 mb-3">
              <div class="justify-content-center">
                <span class="white" style="  display: block; font-size: 14px;">تاريخ المذكرة</span>

                <div class="input-group inline input-group-lg">



                  <input class="form-control" placeholder="اليوم" (change)="incumbentDateChange('day')"
                    [(ngModel)]='incumbentDateDay' [ngModelOptions]="{standalone: true}" id="incumbentDateDay"
                    (keyup.enter)="focusNext('incumbentDateMonth')" [OnlyNumber]="true">

                  <input class="form-control" placeholder="الشهر" (change)="incumbentDateChange('month')"
                    [(ngModel)]='incumbentDateMonth' [ngModelOptions]="{standalone: true}" id="incumbentDateMonth"
                    (keyup.enter)="focusNext('incumbentDateYear')" [OnlyNumber]="true">


                  <input class="form-control" placeholder="السنة" (change)="incumbentDateChange('year')"
                    [(ngModel)]='incumbentDateYear' [ngModelOptions]="{standalone: true}" id="incumbentDateYear"
                    (keyup.enter)="focusNext('incumbent_id')" [OnlyNumber]="true">

                </div>
              </div>
            </div>


            <div class="col-3 mb-3">

              <mat-form-field appearance="outline">
                <mat-label>رقم المذكرة</mat-label>
                <input matInput [formControl]="incumbent_id" id="incumbent_id" (keyup.enter)="focusNext('branch_fk')"
                  [OnlyNumber]="true">
              </mat-form-field>
            </div>


            <div class="col-3 mb-3">
              <label class="form-label">
                رقم الفرع
              </label>

              <ng-select formControlName="branch_fk" id="branch_fk" [items]="list_branch" bindValue="branch_seq"
                bindLabel="branch_name" placeholder="قم باختيار الفرع"
                (keyup.enter)="focusNext('name_of_owner')"></ng-select>

            </div>





            <div class="col-9 mb-3">
              <mat-form-field appearance="outline">
                <mat-label>اسم صاحب الاستحقاق</mat-label>
                <input matInput class="form-control" [formControl]="name_of_owner" id="name_of_owner"
                  (keyup.enter)="focusNext('sanad_close')">
              </mat-form-field>

            </div>

          </div>

        </form>
      </c-card-body>
    </c-card>
  </c-row>




  <c-row>

    <c-card class="mb-4">
      <c-card-header class="card-header">
        المرفقات
      </c-card-header>

      <c-card-body class="card-body">

        <div
          *ngIf="sanad_kid!= null && sanad_kid.sanad_kid_attachements!= null && sanad_kid.sanad_kid_attachements.length>0">
          <div class="detail" *ngFor="let attachment of sanad_kid.sanad_kid_attachements; let i=index;">

            <app-sanad-kid-attachments
              *ngIf="sanad_kid!= null && sanad_kid.sanad_kid_attachements!= null && sanad_kid.sanad_kid_attachements[i]!= null"
              [sanad_kid_attachements]="sanad_kid.sanad_kid_attachements[i]" [index]="i"
              (onDelete)="onAttachmentDelete($event)"></app-sanad-kid-attachments>
          </div>
        </div>
      </c-card-body>
      <c-card-footer>
        <button class="add" mat-raised-button class="add" (click)="addAttachment()">+إضافة مرفق</button>
      </c-card-footer>
    </c-card>
  </c-row>




  <c-row>

    <c-card class="mb-4 card">
      <c-card-header class="card-header">
        تفاصيل السند
      </c-card-header>
      <c-card-body class="card-body">
        
        <div *ngIf="sanad_kid!= null && sanad_kid.sanad_kid_details!= null && sanad_kid.sanad_kid_details.length>0">
          <div class="detail" *ngFor="let detail of sanad_kid.sanad_kid_details; let i=index;">

            <app-sanad-kid-detail
              *ngIf="sanad_kid!= null && sanad_kid.sanad_kid_details!= null && sanad_kid.sanad_kid_details[i]!= null"
              [sanad_kid_detail]="sanad_kid.sanad_kid_details[i]" [index]="i" (onDelete)="onDetailsDelete($event)"
              (updateSum)="updateSum()"></app-sanad-kid-detail>
          </div>
        </div>



      </c-card-body>
      <c-card-footer>
        <button class="add" mat-raised-button class="add" (click)="addDetails()">+إضافة معلومات للسند</button>
      </c-card-footer>
    </c-card>

  </c-row>

  <c-row>
    <c-col [cCol]="2">

    </c-col>
    <c-col [cCol]="2">
      <c-card class="my-4 card smallCard zoom">
        <c-card-header class="card-header">مجموع مدين</c-card-header>
        <c-card-body class="card-body">
          <output>{{sumDebtor}}</output>
        </c-card-body>
      </c-card>
    </c-col>
    <c-col [cCol]="2">
      <c-card class="my-4 card smallCard zoom">
        <c-card-header class="card-header">مجموع دائن</c-card-header>
        <c-card-body class="card-body">
          <output>{{sumCreditor}}</output>
        </c-card-body>
      </c-card>
    </c-col>
    <c-col [cCol]="2">
      <c-card class="my-4 card smallCard zoom">
        <c-card-header class="card-header">الرصيد</c-card-header>
        <c-card-body class="card-body">
          <output>{{balance}}</output>
        </c-card-body>
      </c-card>
    </c-col>
    <c-col [cCol]="2">
      <c-card class="my-4 card smallCard zoom">
        <c-card-header class="card-header">عدد الحركات</c-card-header>
        <c-card-body class="card-body">
          <output>{{actionNum}}</output>
        </c-card-body>
      </c-card>
    </c-col>
    <c-col [cCol]="2">

    </c-col>
  </c-row>






  <c-row>


    <c-card class="mb-4">

      <c-card-header class="card-header">
        قائمة الادخالات المستخدم
      </c-card-header>
      <c-card-body class="card-body">
        <c-row>
          <table mat-table [dataSource]="dataSource_sanad_kid_entry" class="mat-elevation-z8" matSort>

            <ng-container matColumnDef="snd_kid_stg_name">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>المرحلة </th>
              <td mat-cell *matCellDef="let element">{{element?.sanad_kid_stage.snd_kid_stg_name}}</td>
            </ng-container>

            <ng-container matColumnDef="user_entry">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>المستخدم </th>
              <td mat-cell *matCellDef="let element">{{element?.user_entry.user_first_name}}
                {{element?.user_entry.user_last_name}}</td>
            </ng-container>

            <ng-container matColumnDef="date_entry">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>تاريخ الحفظ </th>
              <td mat-cell *matCellDef="let element">{{element?.date_entry | date:'yyyy/MM/dd'}}</td>
            </ng-container>

            <ng-container matColumnDef="action">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>مشاهدة </th>
              <td mat-cell *matCellDef="let element">
                <button (click)="ShowEntry(element)"> مشاهدة</button>
              </td>
            </ng-container>


            <tr mat-header-row *matHeaderRowDef="sanad_kid_entry_displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: sanad_kid_entry_displayedColumns;let idx=index;"></tr>
          </table>
        </c-row>
        <c-row>
          <mat-paginator #paginator [length]="totalRows" [pageIndex]="currentPage" [pageSize]="pageSize"
            [pageSizeOptions]="pageSizeOptions"></mat-paginator>


        </c-row>


      </c-card-body>


    </c-card>


  </c-row>

</c-container>


<!--
            <div class="col-7">

              <mat-form-field appearance="outline">
                <mat-label>دفتر السندات</mat-label>
                <input matInput [formControl]="book_fk" [matAutocomplete]="auto_book_fk" id="Book_fk"
                  (keyup.enter)="focusNext('name_of_owner')">
                <mat-autocomplete #auto_book_fk="matAutocomplete" (optionSelected)="select_Book_Option($event)"
                  [displayWith]="displayBookProperty.bind(this)">
                  <mat-option *ngFor="let option of filter_List_sanad_kid_book | async"
                    [value]="option.sanad_kid_book_seq">
                    {{option.sanad_kid_book_name}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>



            </div>
            -->